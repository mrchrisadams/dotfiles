#!/usr/bin/env ruby
 
# require Dir
 
unless ARGV[0]
  puts 'Usage: newpost "the post title"'
  exit(-1)
end
 
blog_root = "~/Dropbox/mywiki/journal"
wiki_root = "~/Dropbox/mywiki"
date_prefix = Time.now.strftime("%Y-%m-%d")
postname = ARGV[0].strip.downcase.gsub(/ /, '-')

header = <<-END
---
layout: post
title: "#{ARGV[0]}"
---
END

puts ARGV[1]

if ARGV[1] == 'wiki'
  Dir.chdir(wiki_root)
  post = "#{wiki_root}/#{date_prefix}-#{postname}.md"
  File.open(post, 'w') do |f|
    f << header
  end
  
  system("mate", "-w", post)
  
else
  Dir.chdir(blog_root)
  post = "#{blog_root}/_posts/#{date_prefix}-#{postname}.md"
  File.open(post, 'w') do |f|
    f << header
  end

  system("mate", "-w", post)
  system("git", "add", post)

end
 
